# SimpleBlog : Minimalistic Blog Application

## Live Demo
http://kicvm-netand02.cloudapp.net/gh/blog

## Run Instructions
Prerequisites: 
- Install Node.js and npm, and MongoDB server.   
- Install this package by running `npm install`.  


1. Configure environment variables first. Please refer to 'generate-config.js' for details.  
2. To run in development mode: `npm run dev`.  
3. To run in production mode: `npm start`.  

## Purpose
This is a toy project that features a simple end-to-end system using express on the server and react + redux on the client.  
I worked on this project in hopes of getting an initial "full-stack" development experience and apply these technologies which I just picked up at the time.  
I would love to receive some feedback as it's still in progress and is in need of some improvement.  
Please feel free to reach out with any feedback or suggestions!

## Functionality
This blog application currently supports the following features:  
- User Account System:  
  * Local Sign up and Sign up via Google+  
  * Local Sign in and Sign in via Google+  
  * Sign out 
  * Edit username (More about this later)
- Creation, modification, and removal of Blog Posts by the owner  
- Viewing Blog Posts by owner:
  * ex) To view blog posts by user 'elaine01', then enter: '<APP_URL>/@elaine01'. If you are trying on the live demo, it would be http://kicvm-netand02.cloudapp.net/gh/blog/@elaine01. 

## Stack
Server-side:
* [Express](http://expressjs.com) - Node.js web application framework. Used for serving content, REST API, and communicating with the database.
* [MongoDB](https://www.mongodb.com/) - Database.
* [Mongoose](http://mongoosejs.com/) - MongoDB object modeling library for Node.js.
* [PassportJS](http://passportjs.org/) - Authentication middleware for Node.JS. Used in Express to handle user signin/signup/signout authentication.


Client-side
* [React](https://facebook.github.io/react/) - JavaScript library for building UI components.
* [Redux](http://redux.js.org) - A state container for JavaScript web applications. (used with react-redux)  
* [React Router](https://github.com/reactjs/react-router) - Routing library that is used to handle routing in the client side.
* [Redux-Form](http://redux-form.com) - React Form Component that uses react-redux to keep form state in Redux store.
* [Material UI](http://www.material-ui.com/) - Set of React components that implement Google's Material Design
* [Webpack](https://webpack.github.io/) - Module Bundler.


## Architecture & Code Organization
This project is based on client-server architecture model.

### Server
Server related code are located in /src/server.

      server.js  
      passport.js  -  contains authentication configuration code  
      api/         -  functions that operates on the database, called by route handlers  
      models/      -  database schema code   
      routes/      -  route handlers that either authenticate or handle REST API call  
      utils/       -  util functions, and rest go here  

#### User Authentication
User authentication is currently handled by Passport.js.

#### User Management System
Currently username is either taken from the email (to the left of '@' sign) or either
dynamically generated by faker library. User may edit his/her username on User Settings page on the browser.

#### Session Management
User session is managed by express session and passport.js.

#### REST API Functionality
Note that server checks the session when it handles api requests 
when corresponding operation requires some authorization.  

**baseUrl**: '/api'

User:
**endpoint**: '/users'

|  Operation         | method |  query   |  response status |  example |
| ------------------ | ------ | -------- |  --------------  | ---- |
| Check user exists  |  GET   | username |  200, 404        | /api/users?username=someUsernameName |

(usecase: Note this is used when server checks if a username is already in use when
user requests username change)
       
       
Posts:  
**endpoint**: '/posts'


|  Operation         | method |  query params  |  params  | payload (JSON) | response status | response body (JSON) | example |
| ------------------ | ------ | -------------  |  ------  |  ------------- | --------------  | ------------------ | ------------- | ------- |
| Get Posts by Owner  |  GET   | owner  | -  | - |  200, 404  |  array of posts items if successful, otherwise {error: <errorMessage>} | /api/posts?owner=someOwner |  
| Get a Post  |  GET   |  -  |  postId | - | 200, 404  | post item {id: ..., title: ..., content: ..., owner: ...} , otherwise {error: <errorMessage>} | /api/posts/postId |
| Create a Post | POST | - | - |  {"title": ..., "content": ...} | 201, 401, 403 | post resource {"id": .., "title": ..., "content": ..., "owner": ...} if ok, {error: errorText } otherwise |  /api/posts/ with JSON payload with { "title": "someTitle", "content": "someContent" }
| Edit a Post | PUT | - | postId |  {"title": ..., "content": ...} | 200, 401, 403 | post resource  {"id": .., "title": ..., "content": ..., "owner": ...} if ok, {error: errorText } otherwise | /api/posts/somePostId with JSON payload with { "title": "someTitle", "content": "someContent" }
| Remove a Post | DELETE | - | postId | - | 200, 401, 403 | {} | /api/posts/somePostId
       
    
### Client
/src

    index.js 
    actions/        - all redux action types and action creators
    components/     - all presentational components
    containers/     - all redux containers
    reducers/       - all redux reducers
    store/          - redux store configuration
    less/           - css styling
    api.js          - server api calling and related functions. Used by asynchronous action creators.
    theme.js        - Material UI custom theme configuration
    utils/          - any utility functions. currently contains only form validator functions 
    

## Redux
### State
Application logic is stored in immutable state object in the store.  
Currently the redux state only consists of 

    currentUser:  
        username  
        email  
        firstname  
        lastname  
    posts:  
        - id  
          owner  
          title  
          content  
        - ...  
        
Where state.posts is an array of most recently fetch post items.  
Posts are fetched when user looks up posts owned by some user.  

(Also redux form mounts temporary state for form handling onto redux state,   
but this isn't tracked by the application directly.)    

### Actions
Currently action types and action creators are grouped together by resource.  
The action creators which make a server call are enabled by redux-thunk middleware.  
Most of these asynchronous action creators are associated with 3 action types, request, success, and failure types.  

## Styling with Material UI components
Most of the styling of components is done inline since it's not possible
to override predefined styles of Material UI components with css. 
It can still benefit from refactoring of the style code and ideally in theme configuration object if possible.

## TODO List
- Remove boilerplate action types and action creators by writing a action type
generator function and a custom middleware as in [Reducing BoilerPlate](http://redux.js.org/docs/recipes/ReducingBoilerplate.html).
- For checking if username is available, consider making another endpoint.
Currently client side expects 404 on request to check if user exists with such username, but this seems rather hacky.
Besides, the console prints noisy error messages, and it's misleading.
- encrypt password in the database
- Work on thorough error handling on both ends. 
  For example, currently when the form validation on server side fails due to multiple schema errors
  it only returns one of the error messages. (user sign up form)
- Implement comment system
- Write comprehensive comments
- Take out noisy console logging 
- styling - make edit and remove icons visible only when the mouse hovers on the card
- update test code - it's completely broken now that so much code has changed.

 




